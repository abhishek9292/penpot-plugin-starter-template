<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Design Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color, #ffffff);
            color: var(--text-color, #333333);
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--text-secondary, #666);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group select,
        .form-group textarea,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color, #e0e0e0);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: var(--input-bg, #ffffff);
            color: var(--text-color, #333333);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-group select:focus,
        .form-group textarea:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn.loading {
            color: transparent;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .examples {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color, #e0e0e0);
        }

        .examples h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--text-color, #333);
        }

        .example-item {
            margin-bottom: 12px;
            padding: 8px 12px;
            background: var(--example-bg, #f8f9fa);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 13px;
            color: var(--text-secondary, #666);
        }

        .example-item:hover {
            background: var(--example-hover-bg, #e9ecef);
        }

        .connection-status {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
        }

        .connection-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .connection-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Dark theme styles */
        body[data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --text-secondary: #b3b3b3;
            --border-color: #333333;
            --input-bg: #2a2a2a;
            --example-bg: #2a2a2a;
            --example-hover-bg: #333333;
        }
    </style>
</head>
<body>
    <div class="container">
         

        <div id="connectionStatus" class="connection-status disconnected">
            ðŸ”´ Checking LM Studio connection...
        </div>

        <form id="designForm">
            <div class="form-group">
                <label for="designType">Design Type</label>
                <select id="designType" name="designType" required>
                    <option value="">Select design type...</option>
                    <option value="landing-page">Landing Page</option>
                    <option value="mobile-app">Mobile App Screen</option>
                    <option value="dashboard">Dashboard</option>
                    <option value="blog-post">Blog Post Layout</option>
                    <option value="social-media">Social Media Post</option>
                    <option value="business-card">Business Card</option>
                    <option value="poster">Poster/Flyer</option>
                    <option value="wireframe">Wireframe</option>
                    <option value="custom">Custom Layout</option>
                </select>
            </div>

            <div class="form-group">
                <label for="prompt">Describe your design</label>
                <textarea 
                    name=prompt 
                    id="prompt" 
                    placeholder="E.g., Create a modern landing page for a fitness app with a hero section, features, and call-to-action buttons. Use blue and white colors."
                    required
                ></textarea>
            </div>

            <button type="submit" id="generateBtn" class="btn">
                Generate Design
            </button>
        </form>

        <div id="status" class="status"></div>

        <div class="examples">
            <h3>ðŸ’¡ Example Prompts</h3>
            <div class="example-item" data-type="landing-page">
                Modern SaaS landing page with hero section, pricing table, and testimonials
            </div>
            <div class="example-item" data-type="mobile-app">
                E-commerce mobile app product detail screen with image gallery and buy button
            </div>
            <div class="example-item" data-type="dashboard">
                Analytics dashboard with charts, KPI cards, and data tables
            </div>
            <div class="example-item" data-type="social-media">
                Instagram post for a coffee shop with minimal design and warm colors
            </div>
            <div class="example-item" data-type="business-card">
                Professional business card for a graphic designer with modern typography
            </div>
        </div>
    </div>

    <script>
        class AIDesignGenerator {
            constructor() {
                this.form = document.getElementById('designForm');
                this.generateBtn = document.getElementById('generateBtn');
                this.status = document.getElementById('status');
                this.connectionStatus = document.getElementById('connectionStatus');
                this.designTypeSelect = document.getElementById('designType');
                this.promptTextarea = document.getElementById('prompt');

                this.initEventListeners();
                this.checkLMStudioConnection();
                this.handleTheme();
            }

            initEventListeners() {
                // Form submission
                this.form.addEventListener('submit', (e) => this.handleSubmit(e));

                // Example prompts
                document.querySelectorAll('.example-item').forEach(item => {
                    item.addEventListener('click', () => this.useExample(item));
                });

                // Listen for messages from plugin
                window.addEventListener('message', (event) => {
                    console.log('Listen for messages from plugin',event)
                    if (event.data?.source === 'penpot' || event.type === 'message') {
                        this.handlePenpotMessage(event.data);
                    }
                });
            }

            async checkLMStudioConnection() {
                try {
                    const response = await fetch('http://localhost:9000/v1/models', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (response.ok) {
                        this.connectionStatus.className = 'connection-status connected';
                        this.connectionStatus.textContent = 'ðŸŸ¢ Connected to LM Studio';
                    } else {
                        throw new Error('Connection failed');
                    }
                } catch (error) {
                    this.connectionStatus.className = 'connection-status disconnected';
                    this.connectionStatus.textContent = 'ðŸ”´ LM Studio not connected (localhost:9000)';
                }
            }

            handleTheme() {
                // Get theme from URL params
                const urlParams = new URLSearchParams(window.location.search);
                const theme = urlParams.get('theme') || 'light';
                document.body.setAttribute('data-theme', theme);

                // Listen for theme changes
                window.addEventListener('message', (event) => {
                    if (event.data?.type === 'themechange') {
                        document.body.setAttribute('data-theme', event.data.theme);
                    }
                });
            }

            useExample(item) {
                const type = item.dataset.type;
                const text = item.textContent.trim();
                
                this.designTypeSelect.value = type;
                this.promptTextarea.value = text;
                this.promptTextarea.focus();
            }

            async handleSubmit(e) {
                e.preventDefault();
                
                const formData = new FormData(this.form);
                const designType = formData.get('designType');
                const prompt = formData.get('prompt');

                if (!designType || !prompt) {
                    console.log(formData)
                    this.showStatus('Please fill in all fields', 'error');
                    return;
                }

                this.setLoading(true);
                this.showStatus('Generating design with AI...', 'info');

                // Send message to plugin
                window.parent.postMessage({
                    type: 'generate-design',
                    prompt: prompt,
                    designType: designType
                }, '*');
            }

            handlePenpotMessage(data) {
                if (data.type === 'design-generated') {
                    console.log('handlePenpotMessage')
                    this.setLoading(false);
                    
                    if (data.success) {
                        this.showStatus(data.message || 'Design generated successfully!', 'success');
                    } else {
                        this.showStatus(data.message || 'Failed to generate design', 'error');
                    }
                }
            }

            setLoading(loading) {
                  console.log('setLoading',loading)
                this.generateBtn.disabled = loading;
                if (loading) {
                    this.generateBtn.classList.add('loading');
                } else {
                    this.generateBtn.classList.remove('loading');
                }
            }

            showStatus(message, type) {
                console.log('showStatus',message)
                this.status.textContent = message;
                this.status.className = `status ${type}`;
                this.status.style.display = 'block';

                if (type === 'success' || type === 'error') {
                    setTimeout(() => {
                        this.status.style.display = 'none';
                    }, 5000);
                }
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            new AIDesignGenerator();
        });
    </script>
</body>
</html>